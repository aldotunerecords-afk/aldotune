<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset PIN - Aldotune Creative Studio</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><text x='50%' y='50%' dy='.35em' text-anchor='middle' font-size='65' font-family='Arial, sans-serif' font-weight='bold' fill='%23000000'>a</text></svg>">
    
    <style id="main-style" media="not all">
        /* --- RESET & STYLE --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Open Sans', Helvetica, Arial, sans-serif; }
        body { background-color: #ffffff; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; color: #333; padding-top: 60px; }
        .login-container { width: 100%; max-width: 480px; padding: 20px; text-align: center; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .logo-wrapper { margin-bottom: 30px; display: flex; justify-content: center; }
        .logo-img { max-width: 280px; height: auto; display: block; }
        
        .title-text { margin-bottom: 30px; font-size: 18px; font-weight: 600; color: #555; }
        .desc-text { margin-bottom: 20px; font-size: 14px; color: #888; line-height: 1.5; }

        .form-row { display: flex; align-items: center; margin-bottom: 25px; height: 55px; }
        .icon-wrapper { width: 40px; display: flex; justify-content: center; align-items: center; margin-right: 15px; }
        .icon-wrapper svg { width: 22px; height: 22px; fill: #bfbfbf; }
        
        /* Input Style */
        .custom-input { width: 100%; height: 100%; background-color: #f2f2f2; border: none; padding: 0 20px; font-size: 16px; color: #333; outline: none; transition: 0.2s; border-radius: 4px; }
        .custom-input::placeholder { color: #b0b0b0; font-size: 15px; }
        .custom-input:focus { background-color: #e8e8e8; box-shadow: inset 4px 0 0 #0056b3; }
        
        .btn-wrapper { margin-top: 40px; margin-bottom: 30px; }
        .btn-login { background-color: #bfbfbf; color: white; border: none; padding: 15px 80px; border-radius: 50px; font-size: 14px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; cursor: not-allowed; transition: all 0.3s ease; }
        .btn-login.active { background-color: #0056b3; cursor: pointer; box-shadow: 0 5px 15px rgba(0, 86, 179, 0.2); }
        .btn-login.active:hover { background-color: #004494; transform: translateY(-2px); }
        
        /* Link Kembali */
        .back-link { font-size: 14px; color: #333; text-decoration: none; font-weight: bold; }
        .back-link:hover { color: #0056b3; text-decoration: underline; }

    </style>

    <style>
        #boot-terminal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; color: #333333; font-family: 'Consolas', 'Courier New', monospace; font-size: 13px; padding: 20px; z-index: 9999; display: block; overflow: hidden; }
        .log-line { display: block; margin-bottom: 4px; white-space: pre-wrap; }
        
        /* ANTI SPAM */
        body.is-loading { cursor: wait !important; }
        body.is-loading * { pointer-events: none !important; cursor: wait !important; }
    </style>
</head>
<body class="is-loading">

    <div id="boot-terminal"></div>

    <div class="login-container">
        
        <div class="logo-wrapper">
            <img src="acss.png" alt="Aldotune Logo" class="logo-img" id="mainLogo" style="display: none;">
        </div>

        <h2 class="title-text" id="pageTitle" style="display: none;">Pemulihan Akun</h2>
        <p class="desc-text" id="pageDesc" style="display: none;">
            Masukkan email perusahaan yang terdaftar.<br>Kami akan mengirimkan link untuk membuat PIN baru.
        </p>

        <form id="resetForm">
            <div class="form-row">
                <div class="icon-wrapper" id="iconEmail" style="display: none;">
                    <svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                </div>
                <input type="email" id="emailInput" class="custom-input" placeholder="Masukkan Email Anda" readonly="true" onfocus="this.removeAttribute('readonly');" autocomplete="off">
            </div>

            <div class="btn-wrapper">
                <button type="submit" id="btnSubmit" class="btn-login" disabled>KIRIM LINK</button>
            </div>
        </form>

        <a href="index.html" class="back-link" id="backLink" style="display: none;">&larr; Kembali ke Masuk</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Konfigurasi Firebase Anda
        const firebaseConfig = {
            apiKey: "AIzaSyAqOzMh1oUnzxohMET1SsA8ZpnPm7rgjrY",
            authDomain: "aldotune-records.firebaseapp.com",
            databaseURL: "https://aldotune-records-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "aldotune-records",
            storageBucket: "aldotune-records.firebasestorage.app",
            messagingSenderId: "311200667476",
            appId: "1:311200667476:web:7805289d9d01c981ef5ac1",
            measurementId: "G-GQ3Y2GKWG1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- TERMINAL BOOT ---
        const terminal = document.getElementById('boot-terminal');
        const logs = [
            "> System Init...",
            "> Loading Recovery Module...",
            "> [Secure] Connection established.",
            "> [UI] Rendering Reset Form...",
            "> Ready."
        ];

        let lineIndex = 0;
        const logInterval = setInterval(() => {
            if(lineIndex < logs.length) {
                const p = document.createElement('span');
                p.className = 'log-line';
                p.innerText = logs[lineIndex];
                terminal.appendChild(p);
                lineIndex++;
            } else {
                clearInterval(logInterval);
            }
        }, 100);

        // --- UI ELEMENTS ---
        const emailInput = document.getElementById('emailInput');
        const btnSubmit = document.getElementById('btnSubmit');

        // SETELAH 1.2 DETIK (UI LOADED)
        setTimeout(() => {
            document.body.classList.remove('is-loading'); // Hapus wait cursor
            terminal.style.display = 'none';
            
            // Munculkan Elemen
            document.getElementById('mainLogo').style.display = 'block';
            document.getElementById('pageTitle').style.display = 'block';
            document.getElementById('pageDesc').style.display = 'block';
            document.getElementById('iconEmail').style.display = 'flex';
            document.getElementById('backLink').style.display = 'inline-block';
            
            // Nyalakan CSS
            document.getElementById('main-style').setAttribute('media', 'all');

            // Fake URL Token
            if (window.location.hash) window.history.replaceState(null, null, ' ');
            const fakePath = "/aldotune/recovery/mode";
            window.history.replaceState(null, null, "#" + fakePath);

        }, 1200);

        // --- VALIDASI EMAIL ---
        emailInput.addEventListener('input', () => {
            const emailVal = emailInput.value.trim();
            // Cek sederhana: ada @ dan . dan panjang cukup
            if (emailVal.length > 5 && emailVal.includes('@') && emailVal.includes('.')) {
                btnSubmit.removeAttribute('disabled');
                btnSubmit.classList.add('active');
            } else {
                btnSubmit.setAttribute('disabled', 'true');
                btnSubmit.classList.remove('active');
            }
        });

        // --- PROSES RESET PIN ---
        document.getElementById('resetForm').addEventListener('submit', (e) => {
            e.preventDefault();

            // Aktifkan Loading (Anti Spam)
            document.body.classList.add('is-loading');
            const email = emailInput.value;
            const originalText = btnSubmit.innerText;
            btnSubmit.innerText = "MENGIRIM...";

            sendPasswordResetEmail(auth, email)
                .then(() => {
                    document.body.classList.remove('is-loading');
                    
                    // Alert Sukses
                    alert("Link Reset Terkirim!\n\nSilakan cek inbox/spam email Anda. Klik link tersebut untuk membuat PIN Baru.");
                    
                    // Kembali ke halaman login
                    window.location.href = "index.html";
                })
                .catch((error) => {
                    document.body.classList.remove('is-loading');
                    btnSubmit.innerText = originalText;

                    let errorMsg = "Gagal mengirim email.";
                    if (error.code === 'auth/user-not-found') errorMsg = "Email ini tidak terdaftar di sistem.";
                    else if (error.code === 'auth/invalid-email') errorMsg = "Format email salah.";
                    else if (error.code === 'auth/too-many-requests') errorMsg = "Terlalu banyak permintaan. Coba lagi nanti.";
                    
                    alert(errorMsg);
                });
        });

    </script>
</body>
</html>